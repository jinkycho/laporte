<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OrderMapper">

    <!-- Beans 클래스의 객체이름(id)과 클래스이름(type)을 명시한다. -->
    <resultMap id="orderMap"
        type="com.project.laporte.model.Orderlist">
        <!-- Beans의 멤버변수(property)이름과 대상 테이블의 컬럼(column)을 연결한다. -->
        <result property="orderno" column="orderno" />
        <result property="addr1" column="addr1" />
        <result property="addr2" column="addr2" />
        <result property="postcode" column="postcode" />
        <result property="name" column="name" />
        <result property="email" column="email" />
        <result property="phoneno" column="phoneno" />
        <result property="loctype" column="loctype" />
        <result property="name" column="name" />
        <result property="name" column="name" />
        <result property="name" column="name" />
        <result property="name" column="name" />
       
    </resultMap>
	
	<!-- 단일 오더 조회를 위한 기능 정의 -->
    <select id="selectOrder"
        parameterType="com.project.laporte.model.Coupon"
        resultMap="orderMap">
        SELECT couponno, name, DATE_FORMAT(startdate, '%Y-%m-%d') AS startdate, DATE_FORMAT(enddate, '%Y-%m-%d') AS enddate, discount, distype, dupliuse, expire, link, regdate, editdate FROM coupon
        WHERE couponno = #{couponno}
    </select>
	
	<!--  목록 조회를 위한 기능 정의 -->
    <select id="selectCouponList"
        parameterType="com.project.laporte.model.Coupon"
        resultMap="orderMap">
        SELECT couponno, name, DATE_FORMAT(startdate, '%Y-%m-%d')AS startdate, DATE_FORMAT(enddate, '%Y-%m-%d') AS enddate, discount, distype, dupliuse, expire, link, regdate, editdate FROM coupon
    </select>
	
    <!-- 새로운 쿠폰 생성을 위한 기능 정의 -->
	<insert id="insertCoupon"
		parameterType = "com.project.laporte.model.Coupon"
		useGeneratedKeys="true" keyProperty="couponno">
		INSERT INTO coupon(name, startdate, enddate, discount, distype, dupliuse, link, expire, regdate, editdate)
		VALUES(#{name}, #{startdate}, #{enddate}, #{discount}, #{distype}, #{dupliuse}, #{link}, 'N', now(), now())
	</insert>

    <!-- 쿠폰 수정을 위한 기능 정의 -->
    <update id="updateCoupon"
        parameterType="com.project.laporte.model.Coupon">
        UPDATE coupon SET
        name = #{name}, 
        startdate = #{startdate}, 
        enddate = #{enddate}, 
        discount = #{discount}, 
        distype = #{distype}, 
        dupliuse = #{dupliuse}, 
        link = #{link}, 
        expire = 'N', 
        editdate = now()
        WHERE couponno = #{couponno}
    </update>
    
    <!-- 쿠폰 삭제를 위한 기능 정의 -->
    <delete id="deleteCoupon"
        parameterType="com.project.laporte.model.Coupon">
        DELETE FROM coupon WHERE couponno=#{couponno}
    </delete>
	
</mapper>